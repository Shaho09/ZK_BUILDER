name: ZK BUILDER

permissions:
  contents: write

on:
  workflow_dispatch:
    inputs:
      URL:
        description: "XIAOMI.EU ROM URL"
        required: true
      DECRYPT:
        description: "DECRYPT DATA"
        type: boolean
        default: 'false'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout your fork
        uses: actions/checkout@v4

      - name: Setup environment
        run: |
          sudo apt-get update
          sudo apt-get install -y python3 p7zip-full aria2 zip jq
          echo "ZK_HOME=$GITHUB_WORKSPACE" >> $GITHUB_ENV
          echo "ZK_NAME=ZK_VAYU_$(date +'%y%m%d')" >> $GITHUB_ENV

      - name: Download ROM
        run: |
          mkdir -p ROM
          aria2c -s 16 -x 16 "${{ github.event.inputs.URL }}" -o "ROM/base.zip"

      - name: Run Build (Local Scripts)
        run: |
          # En lugar de clonar de Zuri, usamos los scripts que ya tienes en tu repo
          sudo chmod -R +x .
          if [ -f "./build.sh" ]; then
            sudo bash ./build.sh "$GITHUB_ENV" "$GITHUB_WORKSPACE" "${{ env.ZK_NAME }}" "false" "${{ github.event.inputs.DECRYPT }}" "true"
          else
            echo "Error: No se encontr√≥ build.sh en tu repositorio."
            exit 1
          fi

      - name: Upload Finished ROM
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.ZK_NAME }}
          path: ./out/*.zip
          
